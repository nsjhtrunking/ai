<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小精靈遊戲</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        #game-board {
            width: 500px;
            height: 500px;
            margin: 50px auto;
            position: relative;
            background-color: #222;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 2px;
        }
        .cell {
            width: 100%;
            height: 100%;
            background-color: #fff;
            border: 1px solid #ddd;
        }
        .player {
            background-color: #00f;
        }
        .police {
            background-color: #f00;
        }
        .werewolf {
            background-color: #800080;
        }
        .violet {
            background-color: #8a2be2;
        }
        .bean {
            background-color: #ff0;
        }
    </style>
</head>
<body>
    <div id="game-board"></div>
    
    <script>
        const boardSize = 10; // 網格大小 (10x10)
        const numPolice = 3;  // 警察數量
        const numWerewolves = 5;  // 狼人數量
        const numBeans = 20; // 豆子數量

        let playerPos = { x: 0, y: 0 };
        let policePositions = [];
        let werewolfPositions = [];
        let beanPositions = [];
        let violetPositions = [
            { x: 3, y: 3 },
            { x: 6, y: 6 },
            { x: 7, y: 2 }
        ];

        // 創建遊戲地圖
        function createBoard() {
            const gameBoard = document.getElementById("game-board");
            for (let y = 0; y < boardSize; y++) {
                for (let x = 0; x < boardSize; x++) {
                    const cell = document.createElement("div");
                    cell.classList.add("cell");
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    gameBoard.appendChild(cell);
                }
            }
        }

        // 放置紫羅蘭障礙物
        function placeViolet() {
            violetPositions.forEach(pos => {
                const cell = getCell(pos.x, pos.y);
                cell.classList.add("violet");
            });
        }

        // 放置豆子
        function placeBeans() {
            beanPositions = [];
            for (let i = 0; i < numBeans; i++) {
                let x = Math.floor(Math.random() * boardSize);
                let y = Math.floor(Math.random() * boardSize);
                if (isCellEmpty(x, y)) {
                    beanPositions.push({ x, y });
                    const cell = getCell(x, y);
                    cell.classList.add("bean");
                }
            }
        }

        // 放置警察
        function placePolice() {
            policePositions = [];
            for (let i = 0; i < numPolice; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * boardSize);
                    y = Math.floor(Math.random() * boardSize);
                } while (isCellOccupied(x, y));
                policePositions.push({ x, y });
                const cell = getCell(x, y);
                cell.classList.add("police");
            }
        }

        // 放置狼人
        function placeWerewolves() {
            werewolfPositions = [];
            for (let i = 0; i < numWerewolves; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * boardSize);
                    y = Math.floor(Math.random() * boardSize);
                } while (isCellOccupied(x, y));
                werewolfPositions.push({ x, y });
                const cell = getCell(x, y);
                cell.classList.add("werewolf");
            }
        }

        // 判斷格子是否被佔用
        function isCellOccupied(x, y) {
            return policePositions.some(p => p.x === x && p.y === y) ||
                   werewolfPositions.some(w => w.x === x && w.y === y) ||
                   violetPositions.some(v => v.x === x && v.y === y);
        }

        // 判斷格子是否為空
        function isCellEmpty(x, y) {
            return !isCellOccupied(x, y) && !beanPositions.some(b => b.x === x && b.y === y);
        }

        // 獲取指定格子的元素
        function getCell(x, y) {
            return document.querySelector(`[data-x="${x}"][data-y="${y}"]`);
        }

        // 更新玩家的位置
        function movePlayer(dx, dy) {
            const newX = playerPos.x + dx;
            const newY = playerPos.y + dy;

            if (newX >= 0 && newX < boardSize && newY >= 0 && newY < boardSize &&
                !isCellOccupied(newX, newY)) {
                playerPos = { x: newX, y: newY };
                updatePlayerPosition();
            }
        }

        // 更新玩家的畫面
        function updatePlayerPosition() {
            const allCells = document.querySelectorAll('.cell');
            allCells.forEach(cell => cell.classList.remove("player"));
            const playerCell = getCell(playerPos.x, playerPos.y);
            playerCell.classList.add("player");
        }

        // 移動警察
        function movePolice() {
            policePositions.forEach(p => {
                let direction = Math.random() < 0.5 ? "x" : "y";
                let step = Math.random() < 0.5 ? 1 : -1;
                if (direction === "x") {
                    p.x = Math.min(Math.max(p.x + step, 0), boardSize - 1);
                } else {
                    p.y = Math.min(Math.max(p.y + step, 0), boardSize - 1);
                }
                const policeCell = getCell(p.x, p.y);
                policeCell.classList.add("police");
            });
        }

        // 監聽鍵盤事件
        document.addEventListener("keydown", (event) => {
            if (event.key === "ArrowUp") movePlayer(0, -1);
            if (event.key === "ArrowDown") movePlayer(0, 1);
            if (event.key === "ArrowLeft") movePlayer(-1, 0);
            if (event.key === "ArrowRight") movePlayer(1, 0);
        });

        // 開始遊戲
        function startGame() {
            createBoard();
            placeViolet();
            placeBeans();
            placePolice();
            placeWerewolves();
            updatePlayerPosition();

            // 讓警察不斷移動
            setInterval(() => {
                movePolice();
            }, 1000);
        }

        startGame();
    </script>
</body>
</html>
